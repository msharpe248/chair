<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chair Conformation Viewer</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header>
    <div class="viewer-selector">
      <select id="viewer-select">
        <option value="chair">Chair Conformation Viewer</option>
        <option value="energy">Reaction Energy Diagram</option>
      </select>
    </div>
    <nav id="chair-mode-selector" class="mode-selector">
      <button class="mode-btn active" data-mode="cyclohexane">Cyclohexane</button>
      <button class="mode-btn" data-mode="pyranose">Sugar</button>
      <button class="mode-btn" data-mode="decalin">Decalin</button>
    </nav>
    <a href="docs/index.html" class="help-link" title="Documentation">? Help</a>
    <button id="theme-toggle-btn" class="theme-toggle" title="Toggle dark mode">
      <span class="theme-icon light">‚òÄÔ∏è</span>
      <span class="theme-icon dark">üåô</span>
    </button>
    <button id="quiz-mode-btn" class="quiz-btn chair-only">Quiz Mode</button>
    <button id="energy-quiz-mode-btn" class="quiz-btn energy-only hidden">Quiz Mode</button>
  </header>

  <main>
    <section class="viewer-section">
      <!-- Mode-specific controls -->
      <div id="cyclohexane-controls" class="mode-controls">
        <div class="view-toggle">
          <button class="view-btn active" data-view="chair">Chair View</button>
          <button class="view-btn" data-view="newman">Newman Projection</button>
          <select id="newman-bond-select" class="newman-bond-select hidden">
            <option value="0">C1‚ÄìC2</option>
            <option value="1">C2‚ÄìC3</option>
            <option value="2">C3‚ÄìC4</option>
            <option value="3">C4‚ÄìC5</option>
            <option value="4">C5‚ÄìC6</option>
            <option value="5">C6‚ÄìC1</option>
          </select>
        </div>
        <div class="control-row smiles-input-row">
          <label for="smiles-input">SMILES:</label>
          <input type="text" id="smiles-input" placeholder="e.g., CC1CCCCC1" class="smiles-input">
          <button id="parse-smiles-btn" class="small-btn">Load</button>
        </div>
        <div id="smiles-error" class="smiles-error hidden"></div>
        <div class="control-row">
          <label for="preset-select">Example:</label>
          <select id="preset-select">
            <option value="">‚Äî Select a preset ‚Äî</option>
            <optgroup label="Single Substituent">
              <option value="methyl-ax">Methylcyclohexane (axial)</option>
              <option value="methyl-eq">Methylcyclohexane (equatorial)</option>
              <option value="tbutyl-eq">tert-Butylcyclohexane</option>
            </optgroup>
            <optgroup label="1,2-Disubstituted">
              <option value="1,2-dimethyl-cis">1,2-Dimethyl (cis)</option>
              <option value="1,2-dimethyl-trans">1,2-Dimethyl (trans)</option>
            </optgroup>
            <optgroup label="1,3-Disubstituted">
              <option value="1,3-dimethyl-cis">1,3-Dimethyl (cis)</option>
              <option value="1,3-dimethyl-trans">1,3-Dimethyl (trans)</option>
            </optgroup>
            <optgroup label="1,4-Disubstituted">
              <option value="1,4-dimethyl-cis">1,4-Dimethyl (cis)</option>
              <option value="1,4-dimethyl-trans">1,4-Dimethyl (trans)</option>
            </optgroup>
            <optgroup label="Complex Examples">
              <option value="menthol">Menthol-like (1,2,4-trisubstituted)</option>
              <option value="all-axial">All Axial Methyl Groups</option>
              <option value="all-equatorial">All Equatorial Methyl Groups</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div id="pyranose-controls" class="mode-controls hidden">
        <div class="control-row">
          <label for="sugar-select">Sugar:</label>
          <select id="sugar-select">
            <option value="glucose">D-Glucose</option>
            <option value="galactose">D-Galactose</option>
            <option value="mannose">D-Mannose</option>
            <option value="allose">D-Allose</option>
            <option value="altrose">D-Altrose</option>
            <option value="gulose">D-Gulose</option>
            <option value="idose">D-Idose</option>
            <option value="talose">D-Talose</option>
          </select>
        </div>
        <div class="control-row">
          <label>Anomer:</label>
          <div class="anomer-toggle">
            <button id="alpha-btn" class="anomer-btn">Œ± (alpha)</button>
            <button id="beta-btn" class="anomer-btn selected">Œ≤ (beta)</button>
          </div>
        </div>
      </div>

      <div id="decalin-controls" class="mode-controls hidden">
        <div class="control-row">
          <label>Type:</label>
          <div class="decalin-toggle">
            <button id="trans-btn" class="decalin-btn selected">trans</button>
            <button id="cis-btn" class="decalin-btn">cis</button>
          </div>
        </div>
        <div id="decalin-info" class="info-text">
          Bridgehead H's on opposite faces. Rigid - cannot ring flip.
        </div>
      </div>

      <!-- Energy Diagram Controls (hidden by default) -->
      <div id="energy-controls" class="mode-controls hidden">
        <div class="energy-mode-toggle">
          <button class="energy-mode-btn active" data-mode="predict">Conditions</button>
          <button class="energy-mode-btn" data-mode="smiles">SMILES</button>
          <button class="energy-mode-btn" data-mode="preset">Preset</button>
        </div>

        <!-- Prediction Mode Controls -->
        <div id="predict-controls" class="energy-subcontrols">
          <div class="condition-grid">
            <div class="condition-item">
              <label for="substrate-select">Substrate:</label>
              <select id="substrate-select">
                <option value="methyl">Methyl (CH‚ÇÉ-X)</option>
                <option value="primary">1¬∞ Primary</option>
                <option value="secondary" selected>2¬∞ Secondary</option>
                <option value="tertiary">3¬∞ Tertiary</option>
                <option value="allylic">Allylic</option>
                <option value="benzylic">Benzylic</option>
                <option value="vinyl">Vinyl/Aryl</option>
              </select>
            </div>
            <div class="condition-item">
              <label for="nucleophile-select">Nucleophile/Base:</label>
              <select id="nucleophile-select">
                <option value="strong_small">Strong, small (CN‚Åª, I‚Åª)</option>
                <option value="strong_normal" selected>Strong (OH‚Åª, RO‚Åª)</option>
                <option value="strong_bulky">Strong, bulky (tBuO‚Åª)</option>
                <option value="weak">Weak (H‚ÇÇO, ROH)</option>
                <option value="none">None / Very weak</option>
              </select>
            </div>
            <div class="condition-item">
              <label for="leaving-group-select">Leaving Group:</label>
              <select id="leaving-group-select">
                <option value="excellent">Excellent (OTs, I‚Åª)</option>
                <option value="good" selected>Good (Br‚Åª, Cl‚Åª)</option>
                <option value="moderate">Moderate (F‚Åª)</option>
                <option value="poor">Poor (OH, NH‚ÇÇ)</option>
              </select>
            </div>
            <div class="condition-item">
              <label for="solvent-select">Solvent:</label>
              <select id="solvent-select">
                <option value="polar_aprotic">Polar aprotic (DMSO)</option>
                <option value="polar_protic" selected>Polar protic (EtOH)</option>
                <option value="nonpolar">Nonpolar (hexane)</option>
              </select>
            </div>
            <div class="condition-item">
              <label for="temperature-select">Temperature:</label>
              <select id="temperature-select">
                <option value="low">Low (&lt; 0¬∞C)</option>
                <option value="room" selected>Room temp</option>
                <option value="elevated">Elevated (50-80¬∞C)</option>
                <option value="high">High (&gt; 100¬∞C)</option>
              </select>
            </div>
          </div>
          <div class="control-row energy-buttons">
            <button id="predict-btn" class="primary-btn">Predict Mechanism</button>
            <button id="show-competing-btn" class="small-btn">Show All Competing</button>
          </div>
        </div>

        <!-- SMILES Mode Controls -->
        <div id="smiles-controls" class="energy-subcontrols hidden">
          <div class="smiles-reaction-input">
            <div class="smiles-row">
              <label for="reactant-smiles">Reactant:</label>
              <input type="text" id="reactant-smiles" placeholder="e.g., CCBr" class="smiles-input">
            </div>
            <div class="smiles-arrow">‚Üí</div>
            <div class="smiles-row">
              <label for="product-smiles">Product:</label>
              <input type="text" id="product-smiles" placeholder="e.g., CCO" class="smiles-input">
            </div>
          </div>
          <div class="smiles-examples">
            <label>Examples:</label>
            <select id="smiles-example-select">
              <option value="">‚Äî Select example ‚Äî</option>
              <option value="sn2">SN2: CCBr ‚Üí CCO</option>
              <option value="sn1">SN1: CC(C)(C)Br ‚Üí CC(C)(C)O</option>
              <option value="e2">E2: CC(Br)C ‚Üí CC=C</option>
              <option value="hydro">Hydrogenation: CC=CC ‚Üí CCCC</option>
            </select>
          </div>
          <div class="control-row energy-buttons">
            <button id="analyze-smiles-btn" class="primary-btn">Analyze Reaction</button>
          </div>
          <div id="smiles-analysis" class="smiles-analysis hidden">
            <div class="analysis-row">
              <span>Reaction Type:</span>
              <span id="smiles-reaction-type">‚Äî</span>
            </div>
            <div class="analysis-row">
              <span>Bonds Broken:</span>
              <span id="smiles-bonds-broken">‚Äî</span>
            </div>
            <div class="analysis-row">
              <span>Bonds Formed:</span>
              <span id="smiles-bonds-formed">‚Äî</span>
            </div>
            <div class="analysis-row highlight">
              <span>Est. ŒîH:</span>
              <span id="smiles-delta-h">‚Äî</span>
            </div>
          </div>
        </div>

        <!-- Preset Mode Controls -->
        <div id="preset-controls" class="energy-subcontrols hidden">
          <div class="control-row">
            <label for="reaction-preset">Reaction:</label>
            <select id="reaction-preset">
              <option value="sn2">SN2 (concerted)</option>
              <option value="sn1">SN1 (2-step)</option>
              <option value="e2">E2 (concerted)</option>
              <option value="e1">E1 (2-step)</option>
              <option value="hydrogenation">Hydrogenation</option>
              <option value="exothermic">Exothermic (generic)</option>
              <option value="endothermic">Endothermic (generic)</option>
            </select>
          </div>
          <div class="control-row energy-buttons">
            <button id="add-curve-btn" class="small-btn">+ Add Curve</button>
            <button id="clear-curves-btn" class="small-btn">Clear All</button>
          </div>
        </div>
      </div>

      <div class="chair-container" id="chair-container">
        <div class="svg-wrapper" id="svg-wrapper">
          <svg id="chair-svg" viewBox="0 0 400 350"></svg>
        </div>
      </div>
      <div class="canvas-controls">
        <div class="zoom-controls">
          <button id="zoom-out-btn" title="Zoom Out">‚àí</button>
          <span id="zoom-level">100%</span>
          <button id="zoom-in-btn" title="Zoom In">+</button>
          <button id="zoom-reset-btn" title="Reset Zoom">‚Ü∫</button>
        </div>
        <div class="rotation-controls chair-only">
          <label class="checkbox-label">
            <input type="checkbox" id="enable-3d">
            3D
          </label>
          <input type="range" id="rotate-x" min="-60" max="60" value="0" class="rotation-slider hidden" title="Rotate X">
          <input type="range" id="rotate-y" min="-60" max="60" value="0" class="rotation-slider hidden" title="Rotate Y">
          <button id="reset-rotation-btn" class="hidden" title="Reset Rotation">‚Ü∫</button>
        </div>
        <div class="export-controls">
          <button id="export-png-btn" title="Export as PNG">üì∑ PNG</button>
          <button id="export-svg-btn" title="Export as SVG">üìÑ SVG</button>
        </div>
      </div>
      <div class="controls chair-only">
        <button id="flip-btn">Ring Flip</button>
        <button id="reset-btn">Reset</button>
        <label class="checkbox-label">
          <input type="checkbox" id="show-labels" checked>
          Show Ax/Eq Labels
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="show-interactions">
          Show 1,3-Diaxial
        </label>
      </div>
    </section>

    <aside class="info-panel">
      <!-- Quiz Panel (shown when quiz mode active) -->
      <div id="quiz-panel" class="quiz-panel hidden">
        <div class="quiz-header">
          <h3>Practice Quiz</h3>
          <div class="quiz-score">Score: <span id="quiz-score">0/0</span></div>
        </div>
        <div class="quiz-difficulty">
          <button class="difficulty-btn selected" data-level="1">Easy</button>
          <button class="difficulty-btn" data-level="2">Medium</button>
          <button class="difficulty-btn" data-level="3">Hard</button>
        </div>
        <div class="quiz-question-area">
          <p id="quiz-question" class="quiz-question">Click "New Question" to start!</p>
          <div id="quiz-options" class="quiz-options"></div>
          <div id="quiz-feedback" class="quiz-feedback hidden"></div>
        </div>
        <div class="quiz-actions">
          <button id="new-question-btn" class="primary-btn">New Question</button>
          <button id="submit-answer-btn" class="primary-btn" disabled>Submit</button>
          <button id="reset-quiz-btn" class="secondary-btn">Reset</button>
        </div>
      </div>

      <!-- Energy Diagram Info Panel (for reaction energy viewer) -->
      <div id="reaction-energy-panel" class="energy-display hidden">
        <h3>Mechanism Prediction</h3>

        <!-- Prediction Result -->
        <div id="prediction-result" class="prediction-result">
          <div class="prediction-header">
            <span class="predicted-mechanism" id="predicted-mechanism">‚Äî</span>
            <span class="prediction-confidence" id="prediction-confidence"></span>
          </div>
          <div id="mechanism-scores" class="mechanism-scores">
            <div class="score-bar-row">
              <span class="score-label">SN2</span>
              <div class="score-bar-container"><div class="score-bar" id="score-sn2"></div></div>
              <span class="score-value" id="score-sn2-val">0%</span>
            </div>
            <div class="score-bar-row">
              <span class="score-label">SN1</span>
              <div class="score-bar-container"><div class="score-bar" id="score-sn1"></div></div>
              <span class="score-value" id="score-sn1-val">0%</span>
            </div>
            <div class="score-bar-row">
              <span class="score-label">E2</span>
              <div class="score-bar-container"><div class="score-bar" id="score-e2"></div></div>
              <span class="score-value" id="score-e2-val">0%</span>
            </div>
            <div class="score-bar-row">
              <span class="score-label">E1</span>
              <div class="score-bar-container"><div class="score-bar" id="score-e1"></div></div>
              <span class="score-value" id="score-e1-val">0%</span>
            </div>
          </div>
        </div>

        <!-- Explanation -->
        <div id="prediction-explanation" class="prediction-explanation">
          <h4>Why this mechanism?</h4>
          <ul id="explanation-list" class="explanation-list">
            <li class="empty-message">Select conditions and click "Predict"</li>
          </ul>
        </div>

        <!-- Curve Details (for preset mode) -->
        <div id="curve-list" class="curve-list hidden">
        </div>

        <!-- Energy Quiz Panel -->
        <div id="energy-quiz-panel" class="energy-quiz-panel hidden">
          <div class="quiz-header">
            <h4>Energy Diagram Quiz</h4>
            <div class="quiz-score">Score: <span id="energy-quiz-score">0/0</span></div>
          </div>
          <div class="quiz-question-area">
            <p id="energy-quiz-question" class="quiz-question">Click "New Question" to start!</p>
            <div id="energy-quiz-options" class="quiz-options"></div>
            <div id="energy-quiz-feedback" class="quiz-feedback hidden"></div>
          </div>
          <div class="quiz-actions">
            <button id="energy-new-question-btn" class="primary-btn">New Question</button>
            <button id="energy-submit-btn" class="primary-btn" disabled>Submit</button>
          </div>
        </div>
      </div>

      <div id="energy-panel" class="energy-display chair-only">
        <h3>Energy Analysis</h3>
        <div class="energy-chart">
          <div class="energy-bar-row">
            <span class="bar-label">Current</span>
            <div class="bar-container">
              <div id="bar-current" class="energy-bar current"></div>
            </div>
            <span id="bar-current-value" class="bar-value">0.00</span>
          </div>
          <div class="energy-bar-row">
            <span class="bar-label">Flipped</span>
            <div class="bar-container">
              <div id="bar-flipped" class="energy-bar flipped"></div>
            </div>
            <span id="bar-flipped-value" class="bar-value">0.00</span>
          </div>
          <div class="chart-scale">
            <span>0</span>
            <span>kcal/mol</span>
            <span id="chart-max">10</span>
          </div>
        </div>
        <div class="energy-row highlight">
          <span>ŒîE:</span>
          <span id="energy-delta">0.00 kcal/mol</span>
        </div>
        <div class="energy-row">
          <span>Preferred:</span>
          <span id="preferred-chair">Neither</span>
        </div>
      </div>

      <div id="decalin-energy-panel" class="energy-display hidden">
        <h3>Decalin Info</h3>
        <div class="energy-row">
          <span>Relative Stability:</span>
          <span id="decalin-stability">Most stable</span>
        </div>
        <div class="energy-row">
          <span>vs other isomer:</span>
          <span id="decalin-delta">‚Äî</span>
        </div>
      </div>

      <div class="substituents-list chair-only">
        <h3>Substituents</h3>
        <ul id="substituent-list">
          <li class="empty-message">Click a position on the chair to add substituents</li>
        </ul>
      </div>
    </aside>
  </main>

  <!-- Substituent Picker Modal -->
  <div id="substituent-picker" class="picker-modal hidden">
    <div class="picker-content">
      <h4>Select Position & Substituent</h4>
      <div class="position-selector">
        <button class="position-btn" data-position="axial">Axial</button>
        <button class="position-btn" data-position="equatorial">Equatorial</button>
      </div>
      <select id="substituent-select">
        <option value="H">H (Hydrogen)</option>
        <option value="CH3">CH‚ÇÉ (Methyl)</option>
        <option value="C2H5">C‚ÇÇH‚ÇÖ (Ethyl)</option>
        <option value="iPr">iPr (Isopropyl)</option>
        <option value="tBu">tBu (tert-Butyl)</option>
        <option value="Ph">Ph (Phenyl)</option>
        <option value="OH">OH (Hydroxyl)</option>
        <option value="OCH3">OCH‚ÇÉ (Methoxy)</option>
        <option value="F">F (Fluorine)</option>
        <option value="Cl">Cl (Chlorine)</option>
        <option value="Br">Br (Bromine)</option>
        <option value="I">I (Iodine)</option>
        <option value="CN">CN (Cyano)</option>
        <option value="NO2">NO‚ÇÇ (Nitro)</option>
        <option value="NH2">NH‚ÇÇ (Amino)</option>
        <option value="COOH">COOH (Carboxyl)</option>
      </select>
      <div class="picker-actions">
        <button id="add-substituent-btn">Add</button>
        <button id="remove-substituent-btn">Remove</button>
        <button id="cancel-picker-btn">Cancel</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
